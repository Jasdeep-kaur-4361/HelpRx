<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="script/angular.min.js"></script>
    <script>
        var module = angular.module("find-meds", []);
        module.controller("mycontroller", function ($scope, $http) {
            //================================================================================
            $scope.jsoncity;
            $scope.fetchCities = function () {
                // alert("fetch-cities");
                var url = "/get-cities";
                $http.get(url).then(done, fail);
                function done(resp) {
                    // alert(JSON.stringify(resp.data));
                    $scope.jsoncity = resp.data;
                    // alert("&&&");


                }
                function fail(resp) {
                    alert(resp.data);
                    alert(JSON.stringify(resp.data));
                }
            }
            $scope.jsonmed;
            $scope.fetchmed = function () {
                var url = "/get-med";
                $http.get(url).then(done, fail);
                function done(resp) {
                    // alert("---");
                    // alert(JSON.stringify(resp.data));
                    $scope.jsonmed = resp.data;


                }
                function fail(resp) {
                    alert("///");
                    alert(JSON.stringify(resp.data));
                }
            }

            $scope.fetchDonors = function () {
                // alert("started");
                var url = "/fetch-donorsmeds?medKuch=" + $scope.selMeds.med + "&cityKuch=" + $scope.selCity.city;
                // alert(url);
                // alert("fetchdonors");
                $http.get(url).then(done, fail);
                function done(response) {
                    // alert("***");
                    // alert(JSON.stringify(response.data));
                    $scope.JsonArr3 = response.data;

                }
                function fail(response) {
                    alert("+++");
                    alert(response.data);
                }
            }



            //---------------
            $scope.selOneObj;
            $scope.doShowOne = function (selIndex) {
                $scope.selOneObj = $scope.JsonArr3[selIndex];
            }

        })



    </script>
    <style>
        #modal-txt{
            /* color:aqua; */
            text-align: left;
        }
        .logo {
      border-radius: 50%;

    }
    #new-nav {
      background-color: #e6f9ff;
      /* color: aqua; */

    }
    </style>
</head>

<body ng-app="find-meds" ng-controller="mycontroller" ng-init="fetchmed();fetchCities();">
    <div class="shadow">
        <nav class="navbar navbar-expand-lg " id="new-nav">
          <div class="container-fluid">
      
            <p ><img src="pics-3/helping-3.jpg" width="70" class="logo">
              &nbsp;<font size="6" color="#206020"><b>helpRx</b></font>
            </p>
          </div>
          </div>
        </nav>
      </div>

    <center>
        <div class="container mt-5">
            <h3><font color="#0000e6"><i>FIND MEDICINES YOU NEED!!</i></font></h3>

            <div class="row mt-5">
                <div class="col-md-3 offset-md-3">
                    <b>Select City</b> <select class="form-select form-select-lg mb-1"
                        ng-options="obj.city for obj in jsoncity" ng-model="selCity" ng-change="fetchCity();"
                        aria-label=".form-select-lg example">
                        <option value="">Select</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <b>Select Medicine </b> <select class="form-select form-select-lg mb-1"
                        ng-options="obj.med for obj in jsonmed" ng-model="selMeds" ng-change="fetchmeds();"
                        aria-label=".form-select-lg example">
                        <option value="" >Select</option>
                    </select>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-md-16 mt-1">
                    <input type="button" class="btn btn-primary" value="Get DONORS" ng-click="fetchDonors();"
                        style="width: 150px">
                </div>


                <div class="col-md-3 mt-3" ng-repeat="obj in JsonArr3">
                    <div class="card">

                        <div class="card-body">
                            <p class="card-title"><b><h4>Donor's Name: </h4></b>{{obj.name}}</p>
                            <p class="card-text"><b><h4>Med Name: </h4></b>{{obj.med}}</p>
                            <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalDetails"
                                ng-click="doShowOne($index);">DETAILS</a>
                        </div>
                    </div>
                </div>


                <div class="modal fade" tabindex="-1" id="modalDetails">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2 class="modal-title">
                                    <p>
                                        <font color="darkblue"><b>{{selOneObj.email}}</b></font>
                                    </p>

                                </h2>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <img src="uploads/{{selOneObj.pic}}" style="border-radius: 50%;" width="150"
                                    height="150" alt="">
                                <p>
                                    <font color="darkblue" size="6"><b>{{selOneObj.name}}</b></font>
                                </p>

                                <div id="modal-txt" class="mt-5">

                                    <p>
                                        <font color="darkblue" size="4"><b>Contact Number: </b></font>
                                        {{selOneObj.mobile}}
                                    </p>
                                    <p>
                                        <font color="darkblue" size="4"><b>Address: </b></font>{{selOneObj.address}}
                                    </p>
                                    <p>
                                        <font color="darkblue" size="4"><b>Gender: </b></font>{{selOneObj.gender}}
                                    </p>
                                    <p>
                                        <font color="darkblue" size="4"><b>Contact Timings: </b></font>{{selOneObj.ahours}}
                                    </p>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>

                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>

    </center>
</body>

</html>